(()=>{"use strict";var e={11(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BaseAPIClient=void 0,t.BaseAPIClient=class{constructor(e,t){this.apiKey=e,this.baseURL=t}async makeRequest(e,t,a){const o=await fetch(`${this.baseURL}${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...a?.headers},body:JSON.stringify(t),...a});if(!o.ok)throw new Error(`API request failed: ${o.statusText}`);return o}}},265(e,t,a){var o,n=this&&this.__createBinding||(Object.create?function(e,t,a,o){void 0===o&&(o=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,o,n)}:function(e,t,a,o){void 0===o&&(o=a),e[o]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=o(e),i=0;i<a.length;i++)"default"!==a[i]&&n(t,e,a[i]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(e){console.log("VibeAll extension is now active!");const t=new l.StorageManager(e),a=new d.ContextManager,o=new g.ModelClient,n=r.window.createOutputChannel("VibeAll");let s,i=[];function p(e,t,a){const o={id:Date.now().toString()+Math.random().toString(36).substr(2,9),timestamp:Date.now(),level:e,message:t,details:a};i.push(o),i.length>1e3&&(i=i.slice(i.length-1e3));const s=new Date(o.timestamp).toLocaleTimeString();n.appendLine(`[${s}] [${e.toUpperCase()}] ${t}`),a&&n.appendLine(JSON.stringify(a,null,2)),y({type:"newLog",payload:o})}!async function(){try{const e=await t.getAllAPIKeys();e.forEach(({provider:e,key:t})=>{o.setAPIKey(e,t),p("info",`Loaded API key for ${e}`,{keyLength:t.length})}),p("info",`Loaded ${e.length} API keys`)}catch(e){p("error","Failed to load API keys",e)}}();const u=()=>{const n=r.window.activeTextEditor?r.window.activeTextEditor.viewColumn:void 0;if(s)return void s.reveal(n);s=r.window.createWebviewPanel("vibeall","VibeAll AI Assistant",r.ViewColumn.Two,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[r.Uri.file(c.join(e.extensionPath,"dist"))]});const l=s.webview.asWebviewUri(r.Uri.file(c.join(e.extensionPath,"dist","webview.js")));s.webview.html=function(e){return`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>VibeAll AI Assistant</title>\n    <style>\n        body {\n            margin: 0;\n            padding: 0;\n            overflow: hidden;\n        }\n        #root {\n            width: 100vw;\n            height: 100vh;\n        }\n    </style>\n</head>\n<body>\n    <div id="root"></div>\n    <script src="${e}"><\/script>\n</body>\n</html>`}(l),s.webview.onDidReceiveMessage(async e=>{await async function(e){const{type:n,payload:s}=e;try{switch(n){case"getSettings":y({type:"settings",payload:t.getSettings()});break;case"updateSettings":await t.updateSettings(s),p("info","Settings updated");break;case"getChatHistory":y({type:"chatHistory",payload:t.getChatHistory()});break;case"clearChat":await t.clearChatHistory(),y({type:"chatCleared"}),p("info","Chat history cleared");break;case"getLogs":y({type:"logs",payload:i});break;case"clearLogs":i=[],y({type:"logs",payload:[]});break;case"getUsageStats":y({type:"usageStats",payload:t.getUsageStats()});break;case"getAPIKeys":y({type:"apiKeys",payload:await t.getAllAPIKeys()});break;case"storeAPIKey":try{const{provider:e,key:a}=s;await t.storeAPIKey(e,a),o.setAPIKey(e,a),p("info",`API key stored for ${e}`),y({type:"apiKeyStored",payload:{provider:e}})}catch(e){p("error",`Failed to store API key: ${e.message}`),y({type:"apiKeyError",payload:{error:e.message}})}break;case"sendMessage":await async function(e){const{messages:n,provider:s,modelId:i}=e;y({type:"messageLoading"}),p("info",`Processing message with ${s} (${i})`);try{const e=await a.getFullContext(),r=[...n];if(e&&r.length>0&&(r[0].content=`${e}\n\n${r[0].content}`),!o.hasClient(s)){const e=await t.getAPIKey(s);if(!e)throw new Error(`No API key found for ${s}. Please add one in settings.`);o.setAPIKey(s,e)}const c=await o.sendMessage({provider:s,modelId:i},r),l=[...n,{id:Date.now().toString(),role:"assistant",content:c.content,timestamp:Date.now(),model:i,tokens:c.usage?.total_tokens}];await t.saveChatHistory(l);const d=t.getUsageStats();d[s]||(d[s]={requests:0,tokens:0,lastUsed:0}),d[s].requests+=1,d[s].tokens+=c.usage?.total_tokens||0,d[s].lastUsed=Date.now(),await t.updateUsageStats(d),y({type:"messageResponse",payload:{content:c.content,model:i,tokens:c.usage?.total_tokens,usedProvider:s}}),p("info",`AI Response received from ${s}`,{tokens:c.usage?.total_tokens})}catch(e){p("error",`AI processing failed: ${e.message}`,e),y({type:"messageError",payload:{error:e.message}})}}(s);break;case"switchModel":p("info",`Switched model to ${s.provider} / ${s.modelId}`);break;case"applyCode":await async function(e){try{const t=r.window.activeTextEditor;if(!t)return void r.window.showErrorMessage("No active editor");await t.edit(a=>{const o=t.document,n=o.lineAt(o.lineCount-1),s=new r.Range(new r.Position(0,0),n.range.end);a.replace(s,e)}),r.window.showInformationMessage("Code applied successfully!"),p("info","Code applied to file")}catch(e){r.window.showErrorMessage(`Failed to apply code: ${e.message}`),p("error","Failed to apply code",e)}}(s.code,s.filePath);break;default:console.log(`[VibeAll] Unknown message type: ${n}`)}}catch(e){console.error("[VibeAll] Error handling message:",e),p("error",`Error handling message ${n}`,e),y({type:"error",payload:{error:e.message}})}}(e)},void 0,e.subscriptions),s.onDidDispose(()=>{s=void 0},null,e.subscriptions)};function y(e){s&&s.webview.postMessage(e)}const h=r.commands.registerCommand("vibeall.open",u),w=r.commands.registerCommand("vibeall.openSettings",()=>{u(),setTimeout(()=>{y({type:"showSettings"})},500)});e.subscriptions.push(h,w),u()},t.deactivate=function(){console.log("VibeAll extension is now deactivated")};const r=i(a(398)),c=i(a(928)),l=a(361),d=a(827),g=a(485)},361(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StorageManager=void 0,t.StorageManager=class{constructor(e){this.context=e,this.secretStorage=e.secrets}async storeAPIKey(e,t){const a=`vibeall.apikey.${e.toLowerCase()}`;await this.secretStorage.store(a,t),console.log(`[StorageManager] Stored API key for ${e}`)}async getAPIKey(e){const t=`vibeall.apikey.${e.toLowerCase()}`;return await this.secretStorage.get(t)}async getAllAPIKeys(){const e=["groq","google","openai","cerebras","deepseek","sambanova","anthropic"],t=[];for(const a of e){const e=await this.getAPIKey(a);e&&t.push({provider:a,key:e})}return t}async deleteAPIKey(e){const t=`vibeall.apikey.${e.toLowerCase()}`;await this.secretStorage.delete(t),console.log(`[StorageManager] Deleted API key for ${e}`)}getSettings(){return this.context.globalState.get("vibeall.settings",{autoRunCommands:!1,autoApplyEdits:!1,showMiniDashboard:!0,compactMode:!1,alwaysShowPlan:!1,planMode:!1,theme:{primaryColor:"#FF5722",accentColor:"#FF9800",mode:"dark"}})}async updateSettings(e){await this.context.globalState.update("vibeall.settings",e),console.log("[StorageManager] Settings updated")}getChatHistory(){return this.context.globalState.get("vibeall.chatHistory",[])}async saveChatHistory(e){await this.context.globalState.update("vibeall.chatHistory",e)}async clearChatHistory(){await this.context.globalState.update("vibeall.chatHistory",[]),console.log("[StorageManager] Chat history cleared")}getUsageStats(){return this.context.globalState.get("vibeall.usageStats",{})}async updateUsageStats(e){await this.context.globalState.update("vibeall.usageStats",e)}}},398(e){e.exports=require("vscode")},441(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.GroqClient=void 0;const o=a(11);class n extends o.BaseAPIClient{constructor(e){super(e,"https://api.groq.com/openai/v1")}async sendMessage(e,t){const a=await this.makeRequest("/chat/completions",{model:e,messages:t,temperature:.7,max_tokens:8192}),o=await a.json();return{content:o.choices[0].message.content,done:!0,model:o.model,tokens:o.usage?.total_tokens}}}t.GroqClient=n},485(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.ModelClient=void 0;const o=a(441),n=a(791),s=a(778);t.ModelClient=class{constructor(){this.clients=new Map}setAPIKey(e,t){const a=e.toLowerCase();switch(a){case"groq":this.clients.set("groq",new o.GroqClient(t));break;case"google":this.clients.set("google",new n.GoogleClient(t));break;case"openai":case"cerebras":case"deepseek":case"sambanova":case"anthropic":this.clients.set(a,new s.OpenAIClient(t,a))}}async sendMessage(e,t){const{provider:a,modelId:o,apiKey:n}=e;n&&this.setAPIKey(a,n);const s=this.clients.get(a.toLowerCase());if(!s)throw new Error(`No API key configured for provider: ${a}`);return await s.sendMessage(o,t)}hasClient(e){return this.clients.has(e.toLowerCase())}getAvailableProviders(){return Array.from(this.clients.keys())}}},778(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIClient=void 0;const o=a(11);class n extends o.BaseAPIClient{constructor(e,t="openai"){const a={openai:"https://api.openai.com/v1",cerebras:"https://api.cerebras.ai/v1",deepseek:"https://api.deepseek.com/v1",sambanova:"https://api.sambanova.ai/v1"};super(e,a[t]||a.openai)}async sendMessage(e,t){const a=await this.makeRequest("/chat/completions",{model:e,messages:t,temperature:.7,max_tokens:4096}),o=await a.json();return{content:o.choices[0].message.content,done:!0,model:o.model,tokens:o.usage?.total_tokens}}}t.OpenAIClient=n},791(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleClient=void 0;const o=a(11);class n extends o.BaseAPIClient{constructor(e){super(e,"https://generativelanguage.googleapis.com/v1beta")}async sendMessage(e,t){const a=t.map(e=>({role:"assistant"===e.role?"model":"user",parts:[{text:e.content}]})),o=await fetch(`${this.baseURL}/models/${e}:generateContent?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:a})});if(!o.ok)throw new Error(`Gemini API error: ${o.statusText}`);const n=await o.json();return{content:n.candidates[0].content.parts[0].text,done:!0,model:e,tokens:n.usageMetadata?.totalTokenCount}}}t.GoogleClient=n},827(e,t,a){var o,n=this&&this.__createBinding||(Object.create?function(e,t,a,o){void 0===o&&(o=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,o,n)}:function(e,t,a,o){void 0===o&&(o=a),e[o]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a=o(e),i=0;i<a.length;i++)"default"!==a[i]&&n(t,e,a[i]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ContextManager=void 0;const r=i(a(398));t.ContextManager=class{async getActiveFileContext(){const e=r.window.activeTextEditor;if(!e)return"";const t=e.document,a=e.selection;let o=`File: ${t.fileName}\n`;return o+=`Language: ${t.languageId}\n\n`,a.isEmpty?(o+=`Full file content:\n\`\`\`${t.languageId}\n`,o+=t.getText(),o+="\n```\n"):(o+=`Selected code:\n\`\`\`${t.languageId}\n`,o+=t.getText(a),o+="\n```\n"),o}async getWorkspaceContext(){const e=r.workspace.workspaceFolders;if(!e||0===e.length)return"";let t="Workspace Information:\n";t+=`Root: ${e[0].uri.fsPath}\n`;try{const a=r.Uri.joinPath(e[0].uri,"package.json"),o=await r.workspace.fs.readFile(a),n=JSON.parse(o.toString());t+="\nProject Dependencies:\n",n.dependencies&&(t+="Dependencies: "+Object.keys(n.dependencies).join(", ")+"\n"),n.devDependencies&&(t+="DevDependencies: "+Object.keys(n.devDependencies).join(", ")+"\n")}catch(e){}return t}async getDiagnosticsContext(){const e=r.window.activeTextEditor;if(!e)return"";const t=r.languages.getDiagnostics(e.document.uri);if(0===t.length)return"";let a="\nCurrent Errors/Warnings:\n";return t.forEach((e,t)=>{const o=e.severity===r.DiagnosticSeverity.Error?"ERROR":"WARNING";a+=`${t+1}. [${o}] Line ${e.range.start.line+1}: ${e.message}\n`}),a}async getFullContext(){const e=await this.getActiveFileContext();return`${await this.getWorkspaceContext()}\n${e}\n${await this.getDiagnosticsContext()}`}}},928(e){e.exports=require("path")}},t={},a=function a(o){var n=t[o];if(void 0!==n)return n.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,a),s.exports}(265),o=exports;for(var n in a)o[n]=a[n];a.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();