(()=>{"use strict";var e={11(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BaseAPIClient=void 0,t.BaseAPIClient=class{constructor(e,t){this.apiKey=e,this.baseURL=t}async makeRequest(e,t,n){const a=await fetch(`${this.baseURL}${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,...n?.headers},body:JSON.stringify(t),...n});if(!a.ok)throw new Error(`API request failed: ${a.statusText}`);return a}}},240(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.BytezClient=void 0;const a=n(11);class s extends a.BaseAPIClient{constructor(e){super(e,"https://api.bytez.com/models/v2")}async sendMessage(e,t){let n=t;const a=e.includes("sentence-transformers")||e.includes("bge")||e.includes("nomic")||e.includes("clip")||e.includes("siglip"),s=e.includes("stable")||e.includes("whisper")||e.includes("bark");if(a||s){const e=t[t.length-1];n=e?e.content:""}const o={input:n};a||e.includes("whisper")||e.includes("bark")||(o.params={max_tokens:1024,temperature:.7});const i=await this.makeRequest(`/${e}`,o),r=(await i.json()).output;let c="";return c="string"==typeof r?r:Array.isArray(r)&&r[0]&&r[0].content?r[0].content:JSON.stringify(r),{content:c,done:!0,model:e,tokens:0}}async makeRequest(e,t){const n=`${this.baseURL}${e}`,a={"Content-Type":"application/json",Authorization:`Key ${this.apiKey}`},s=await fetch(n,{method:"POST",headers:a,body:JSON.stringify(t)});if(!s.ok){const e=await s.text();throw new Error(`API Request Failed: ${s.status} ${s.statusText} - ${e}`)}return s}}t.BytezClient=s},265(e,t,n){var a,s=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,s)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},a(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=a(e),i=0;i<n.length;i++)"default"!==n[i]&&s(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(e){console.log("VibeAll extension is now active!");const t=new l.StorageManager(e),n=new d.ContextManager,a=new p.ModelClient,s=r.window.createOutputChannel("VibeAll");let o,i=[];function g(e,t,n){const a={id:Date.now().toString()+Math.random().toString(36).substr(2,9),timestamp:Date.now(),level:e,message:t,details:n};i.push(a),i.length>1e3&&(i=i.slice(i.length-1e3));const o=new Date(a.timestamp).toLocaleTimeString();s.appendLine(`[${o}] [${e.toUpperCase()}] ${t}`),n&&s.appendLine(JSON.stringify(n,null,2)),y({type:"newLog",payload:a})}!async function(){try{const e=await t.getAllAPIKeys();e.forEach(({provider:e,key:t})=>{a.setAPIKey(e,t),g("info",`Loaded API key for ${e}`,{keyLength:t.length})}),g("info",`Loaded ${e.length} API keys`)}catch(e){g("error","Failed to load API keys",e)}}();const u=()=>{const s=r.window.activeTextEditor?r.window.activeTextEditor.viewColumn:void 0;if(o)return void o.reveal(s);o=r.window.createWebviewPanel("vibeall","VibeAll AI Assistant",r.ViewColumn.Two,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[r.Uri.file(c.join(e.extensionPath,"dist"))]});const l=o.webview.asWebviewUri(r.Uri.file(c.join(e.extensionPath,"dist","webview.js")));o.webview.html=function(e){return`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>VibeAll AI Assistant</title>\n    <style>\n        body {\n            margin: 0;\n            padding: 0;\n            overflow: hidden;\n        }\n        #root {\n            width: 100vw;\n            height: 100vh;\n        }\n    </style>\n</head>\n<body>\n    <div id="root"></div>\n    <script src="${e}"><\/script>\n</body>\n</html>`}(l),o.webview.onDidReceiveMessage(async e=>{await async function(e){const{type:s,payload:o}=e;try{switch(s){case"getSettings":y({type:"settings",payload:t.getSettings()});break;case"updateSettings":await t.updateSettings(o),g("info","Settings updated");break;case"getChatHistory":y({type:"chatHistory",payload:t.getChatHistory()});break;case"clearChat":await t.clearChatHistory(),y({type:"chatCleared"}),g("info","Chat history cleared");break;case"getLogs":y({type:"logs",payload:i});break;case"clearLogs":i=[],y({type:"logs",payload:[]});break;case"getUsageStats":y({type:"usageStats",payload:t.getUsageStats()});break;case"getAPIKeys":y({type:"apiKeys",payload:await t.getAllAPIKeys()});break;case"storeAPIKey":try{const{provider:e,key:n}=o;await t.storeAPIKey(e,n),a.setAPIKey(e,n),g("info",`API key stored for ${e}`),y({type:"apiKeyStored",payload:{provider:e}})}catch(e){g("error",`Failed to store API key: ${e.message}`),y({type:"apiKeyError",payload:{error:e.message}})}break;case"sendMessage":await async function(e){const{messages:s,provider:o,modelId:i}=e;y({type:"messageLoading"}),g("info",`Processing message with ${o} (${i})`);try{const e=await n.getFullContext(),r=[...s];if(e&&r.length>0&&(r[0].content=`${e}\n\n${r[0].content}`),!a.hasClient(o)){const e=await t.getAPIKey(o);if(!e)throw new Error(`No API key found for ${o}. Please add one in settings.`);a.setAPIKey(o,e)}const c=await a.sendMessage({provider:o,modelId:i},r),l=[...s,{id:Date.now().toString(),role:"assistant",content:c.content,timestamp:Date.now(),model:i,tokens:c.usage?.total_tokens}];await t.saveChatHistory(l);const d=t.getUsageStats();d[o]||(d[o]={requests:0,tokens:0,lastUsed:0}),d[o].requests+=1,d[o].tokens+=c.usage?.total_tokens||0,d[o].lastUsed=Date.now(),await t.updateUsageStats(d),y({type:"messageResponse",payload:{content:c.content,model:i,tokens:c.usage?.total_tokens,usedProvider:o}}),g("info",`AI Response received from ${o}`,{tokens:c.usage?.total_tokens})}catch(e){g("error",`AI processing failed: ${e.message}`,e),y({type:"messageError",payload:{error:e.message}})}}(o);break;case"switchModel":g("info",`Switched model to ${o.provider} / ${o.modelId}`);break;case"applyCode":await async function(e){try{const t=r.window.activeTextEditor;if(!t)return void r.window.showErrorMessage("No active editor");await t.edit(n=>{const a=t.document,s=a.lineAt(a.lineCount-1),o=new r.Range(new r.Position(0,0),s.range.end);n.replace(o,e)}),r.window.showInformationMessage("Code applied successfully!"),g("info","Code applied to file")}catch(e){r.window.showErrorMessage(`Failed to apply code: ${e.message}`),g("error","Failed to apply code",e)}}(o.code,o.filePath);break;default:console.log(`[VibeAll] Unknown message type: ${s}`)}}catch(e){console.error("[VibeAll] Error handling message:",e),g("error",`Error handling message ${s}`,e),y({type:"error",payload:{error:e.message}})}}(e)},void 0,e.subscriptions),o.onDidDispose(()=>{o=void 0},null,e.subscriptions)};function y(e){o&&o.webview.postMessage(e)}const h=r.commands.registerCommand("vibeall.open",u),w=r.commands.registerCommand("vibeall.openSettings",()=>{u(),setTimeout(()=>{y({type:"showSettings"})},500)});e.subscriptions.push(h,w),u()},t.deactivate=function(){console.log("VibeAll extension is now deactivated")};const r=i(n(398)),c=i(n(928)),l=n(361),d=n(827),p=n(485)},361(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StorageManager=void 0,t.StorageManager=class{constructor(e){this.context=e,this.secretStorage=e.secrets}async storeAPIKey(e,t){const n=`vibeall.apikey.${e.toLowerCase()}`;await this.secretStorage.store(n,t),console.log(`[StorageManager] Stored API key for ${e}`)}async getAPIKey(e){const t=`vibeall.apikey.${e.toLowerCase()}`;return await this.secretStorage.get(t)}async getAllAPIKeys(){const e=["groq","google","openai","cerebras","deepseek","sambanova","anthropic"],t=[];for(const n of e){const e=await this.getAPIKey(n);e&&t.push({provider:n,key:e})}return t}async deleteAPIKey(e){const t=`vibeall.apikey.${e.toLowerCase()}`;await this.secretStorage.delete(t),console.log(`[StorageManager] Deleted API key for ${e}`)}getSettings(){return this.context.globalState.get("vibeall.settings",{autoRunCommands:!1,autoApplyEdits:!1,showMiniDashboard:!0,compactMode:!1,alwaysShowPlan:!1,planMode:!1,theme:{primaryColor:"#FF5722",accentColor:"#FF9800",mode:"dark"}})}async updateSettings(e){await this.context.globalState.update("vibeall.settings",e),console.log("[StorageManager] Settings updated")}getChatHistory(){return this.context.globalState.get("vibeall.chatHistory",[])}async saveChatHistory(e){await this.context.globalState.update("vibeall.chatHistory",e)}async clearChatHistory(){await this.context.globalState.update("vibeall.chatHistory",[]),console.log("[StorageManager] Chat history cleared")}getUsageStats(){return this.context.globalState.get("vibeall.usageStats",{})}async updateUsageStats(e){await this.context.globalState.update("vibeall.usageStats",e)}}},398(e){e.exports=require("vscode")},441(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.GroqClient=void 0;const a=n(11);class s extends a.BaseAPIClient{constructor(e){super(e,"https://api.groq.com/openai/v1")}async sendMessage(e,t){const n=await this.makeRequest("/chat/completions",{model:e,messages:t,temperature:.7,max_tokens:8192}),a=await n.json();return{content:a.choices[0].message.content,done:!0,model:a.model,tokens:a.usage?.total_tokens}}}t.GroqClient=s},485(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ModelClient=void 0;const a=n(441),s=n(791),o=n(778),i=n(860),r=n(240);t.ModelClient=class{constructor(){this.clients=new Map}setAPIKey(e,t){const n=e.toLowerCase();switch(n){case"groq":this.clients.set("groq",new a.GroqClient(t));break;case"google":this.clients.set("google",new s.GoogleClient(t));break;case"anthropic":this.clients.set("anthropic",new i.AnthropicClient(t));break;case"openai":case"cerebras":case"deepseek":case"sambanova":case"xai":case"novita":case"aimlapi":this.clients.set(n,new o.OpenAIClient(t,n));break;case"bytez":this.clients.set("bytez",new r.BytezClient(t))}}async sendMessage(e,t){const{provider:n,modelId:a,apiKey:s}=e;s&&this.setAPIKey(n,s);const o=this.clients.get(n.toLowerCase());if(!o)throw new Error(`No API key configured for provider: ${n}`);return await o.sendMessage(a,t)}hasClient(e){return this.clients.has(e.toLowerCase())}getAvailableProviders(){return Array.from(this.clients.keys())}}},778(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIClient=void 0;const a=n(11);class s extends a.BaseAPIClient{constructor(e,t="openai"){const n={openai:"https://api.openai.com/v1",cerebras:"https://api.cerebras.ai/v1",deepseek:"https://api.deepseek.com/v1",sambanova:"https://api.sambanova.ai/v1",xai:"https://api.x.ai/v1",novita:"https://api.novita.ai/openai",aimlapi:"https://api.aimlapi.com/v1"};super(e,n[t]||n.openai)}async sendMessage(e,t){const n=await this.makeRequest("/chat/completions",{model:e,messages:t,temperature:.7,max_tokens:"kat-coder"===e?1e3:4096}),a=await n.json();return{content:a.choices[0].message.content,done:!0,model:a.model,tokens:a.usage?.total_tokens}}}t.OpenAIClient=s},791(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleClient=void 0;const a=n(11);class s extends a.BaseAPIClient{constructor(e){super(e,"https://generativelanguage.googleapis.com/v1beta")}async sendMessage(e,t){const n=t.map(e=>({role:"assistant"===e.role?"model":"user",parts:[{text:e.content}]})),a=await fetch(`${this.baseURL}/models/${e}:generateContent?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:n})});if(!a.ok)throw new Error(`Gemini API error: ${a.statusText}`);const s=await a.json();return{content:s.candidates[0].content.parts[0].text,done:!0,model:e,tokens:s.usageMetadata?.totalTokenCount}}}t.GoogleClient=s},827(e,t,n){var a,s=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,s)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},a(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=a(e),i=0;i<n.length;i++)"default"!==n[i]&&s(t,e,n[i]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ContextManager=void 0;const r=i(n(398));t.ContextManager=class{async getActiveFileContext(){const e=r.window.activeTextEditor;if(!e)return"";const t=e.document,n=e.selection;let a=`File: ${t.fileName}\n`;return a+=`Language: ${t.languageId}\n\n`,n.isEmpty?(a+=`Full file content:\n\`\`\`${t.languageId}\n`,a+=t.getText(),a+="\n```\n"):(a+=`Selected code:\n\`\`\`${t.languageId}\n`,a+=t.getText(n),a+="\n```\n"),a}async getWorkspaceContext(){const e=r.workspace.workspaceFolders;if(!e||0===e.length)return"";let t="Workspace Information:\n";t+=`Root: ${e[0].uri.fsPath}\n`;try{const n=r.Uri.joinPath(e[0].uri,"package.json"),a=await r.workspace.fs.readFile(n),s=JSON.parse(a.toString());t+="\nProject Dependencies:\n",s.dependencies&&(t+="Dependencies: "+Object.keys(s.dependencies).join(", ")+"\n"),s.devDependencies&&(t+="DevDependencies: "+Object.keys(s.devDependencies).join(", ")+"\n")}catch(e){}return t}async getDiagnosticsContext(){const e=r.window.activeTextEditor;if(!e)return"";const t=r.languages.getDiagnostics(e.document.uri);if(0===t.length)return"";let n="\nCurrent Errors/Warnings:\n";return t.forEach((e,t)=>{const a=e.severity===r.DiagnosticSeverity.Error?"ERROR":"WARNING";n+=`${t+1}. [${a}] Line ${e.range.start.line+1}: ${e.message}\n`}),n}async getFullContext(){const e=await this.getActiveFileContext();return`${await this.getWorkspaceContext()}\n${e}\n${await this.getDiagnosticsContext()}`}}},860(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.AnthropicClient=void 0;const a=n(11);class s extends a.BaseAPIClient{constructor(e){super(e,"https://api.anthropic.com/v1")}async sendMessage(e,t){let n="";const a={model:e,messages:t.filter(e=>"system"!==e.role||(n+=e.content+"\n",!1)),max_tokens:8192,system:n.trim()||void 0},s=await fetch(`${this.baseURL}/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify(a)});if(!s.ok){const e=await s.text();throw new Error(`Anthropic API error: ${s.status} - ${e}`)}const o=await s.json();return{content:o.content[0].text,done:!0,model:o.model,tokens:o.usage?.output_tokens}}}t.AnthropicClient=s},928(e){e.exports=require("path")}},t={},n=function n(a){var s=t[a];if(void 0!==s)return s.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,n),o.exports}(265),a=exports;for(var s in n)a[s]=n[s];n.__esModule&&Object.defineProperty(a,"__esModule",{value:!0})})();